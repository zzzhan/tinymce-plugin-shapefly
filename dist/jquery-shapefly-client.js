/*! jquery-shapefly-client 2015-08-11 */
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):window.jQuery&&a(window.jQuery)}(function(a){var b=function(){var a=document.getElementsByTagName("script");return a[a.length-1].src.split("?")[0].split("/").slice(0,-1).join("/")+"/"},c=b(),d=function(b,d){this.el=b;var e=b.attr("id");void 0===e&&b.addClass("shapefly");var f=b.selector||(void 0===e?".shapefly":"#"+b.attr("id"));this.opt=a.extend({url:"//shapefly.com/editor/",proxy:c+"shapefly.html",parent:window.location.href,selector:f},d)};d.prototype={constructor:d,response:function(a){var b='<img src="'+a.data+'" data-sf-uuid="'+a.uuid+'" title="'+a.name+"\nCreated by"+this.opt.url+'"/>';this.el.trigger("shapefly",[b,a])},imgMouseover:function(b){var c=a(b.target),d=c.offset();this.uuid=c.data("uuid"),this.edit.css({left:d.left+"px",top:d.top+"px"}).show()},imgMouseout:function(b){0===a(b.relatedTarget).closest(".shapefly-edit").size()&&this.edit.hide()},open:function(a){a&&(a.stopPropagation(),a.preventDefault()),this.uuid&&(this.opt.uuid=this.uuid);var b=JSON.stringify(this.opt);return window.open(this.opt.url,b),!1},bindImgEvent:function(b){this.edit=a('<span style="position:absolute;display:none;" class="shapefly-edit" contentEditable="false"><a href="#" class="btn btn-default" title="Shapefly"><i class="fa fa-edit"></i>Edit</a></span>'),b.append(this.edit),this.edit.on("click",a.proxy(this.open,this)),b.on("mouseover","img[data-sf-uuid]",a.proxy(this.imgMouseover,this)),b.on("mouseleave","img[data-sf-uuid]",a.proxy(this.imgMouseout,this))}},a.fn.shapefly=function(b){var c=arguments;return this.each(function(){var e=a(this),f=e.data("shapefly"),g="object"==typeof b?b:{};f||"string"==typeof b?"string"==typeof b&&f[b].apply(f,Array.prototype.slice.call(c,1)):e.data("shapefly",new d(e,g))})},a.shapeflyResp=function(b){console.log(b);var c=a.parseJSON(b),d=a(c.selector);d.data("shapefly").response(c)},a.shapefly=function(a){var b=a||window.name;window.opener.$.shapeflyResp(b)}});